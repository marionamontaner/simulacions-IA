<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <title>DistribuciÃ³ de masses estelÂ·lars</title>
    <style>
        canvas {
            border: 1px solid #555;
            background-color: black;
        }
        body {
            font-family: sans-serif;
            text-align: center;
            background-color: #111;
            color: white;
            padding: 20px;
        }
        input {
            padding: 5px;
            font-size: 16px;
            width: 80px;
            margin: 10px;
        }
        button {
            padding: 6px 15px;
            font-size: 16px;
            cursor: pointer;
        }
        #resultats {
            margin-top: 20px;
            font-size: 16px;
            color: lightblue;
            text-align: left;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body>
    <h1>DistribuciÃ³ de masses estelÂ·lars â€“ Diagrama H-R</h1>
    <p>Introdueix el nombre d'estrelles a generar:</p>
    <input type="number" id="numStarsInput" value="100">
    <button onclick="generarEstrelles()">Generar</button>

    <div id="resultats"></div>

    <canvas id="hrCanvas" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById("hrCanvas");
        const ctx = canvas.getContext("2d");
        const width = canvas.width;
        const height = canvas.height;

        // Marges
        const paddingLeft = 80;
        const paddingRight = 40;
        const paddingTop = 40;
        const paddingBottom = 60;

        const plotWidth = width - paddingLeft - paddingRight;
        const plotHeight = height - paddingTop - paddingBottom;

        const tempMin = 3000;
        const tempMax = 30000;
        const lumMin = 0.01;
        const lumMax = 10000;

        function tempToX(temp) {
            const logTemp = Math.log10(temp);
            const logMin = Math.log10(tempMin);
            const logMax = Math.log10(tempMax);
            const norm = (logTemp - logMin) / (logMax - logMin);
            return paddingLeft + plotWidth * (1 - norm);
        }

        function lumToY(lum) {
            const logLum = Math.log10(lum);
            const logMin = Math.log10(lumMin);
            const logMax = Math.log10(lumMax);
            const norm = (logLum - logMin) / (logMax - logMin);
            return paddingTop + plotHeight * (1 - norm);
        }

        function drawAxes() {
            ctx.clearRect(0, 0, width, height);
            ctx.strokeStyle = "white";
            ctx.fillStyle = "white";
            ctx.lineWidth = 1;
            ctx.font = "13px sans-serif";

            const temps = [30000, 20000, 10000, 7500, 6000, 5000, 4000, 3000];
            temps.forEach(temp => {
                const x = tempToX(temp);
                ctx.beginPath();
                ctx.moveTo(x, height - paddingBottom);
                ctx.lineTo(x, height - paddingBottom + 6);
                ctx.stroke();
                ctx.fillText(temp + " K", x - 25, height - paddingBottom + 20);
            });

            const lums = [0.01, 0.1, 1, 10, 100, 1000, 10000];
            lums.forEach(lum => {
                const y = lumToY(lum);
                ctx.beginPath();
                ctx.moveTo(paddingLeft - 6, y);
                ctx.lineTo(paddingLeft, y);
                ctx.stroke();
                ctx.fillText("L=" + lum + " â˜‰", 10, y + 4);
            });

            ctx.beginPath();
            ctx.moveTo(paddingLeft, paddingTop);
            ctx.lineTo(paddingLeft, height - paddingBottom);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(paddingLeft, height - paddingBottom);
            ctx.lineTo(width - paddingRight, height - paddingBottom);
            ctx.stroke();

            ctx.fillText("Temperatura (K) â†’", width / 2 - 50, height - 15);
            ctx.save();
            ctx.translate(25, height / 2 + 40);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText("Luminositat (Lâ˜‰)", 0, 0);
            ctx.restore();
        }

        // DistribuciÃ³ Salpeter: P(m) âˆ m^(-2.35)
        function generarMassaSalpeter(min = 0.1, max = 50) {
            const alpha = 2.35;
            const r = Math.random();
            return Math.pow((Math.pow(max, 1 - alpha) - r * (Math.pow(max, 1 - alpha) - Math.pow(min, 1 - alpha))), 1 / (1 - alpha));
        }

        function generarEstrelles() {
            const numStars = parseInt(document.getElementById("numStarsInput").value);
            let masses = [];

            for (let i = 0; i < numStars; i++) {
                const m = generarMassaSalpeter();
                masses.push(m);
            }

            // ClassificaciÃ³ en grups
            let comptadors = {
                moltBaixa: 0,
                baixa: 0,
                mitjana: 0,
                alta: 0,
                moltAlta: 0
            };

            for (let m of masses) {
                if (m < 0.5) comptadors.moltBaixa++;
                else if (m < 1) comptadors.baixa++;
                else if (m < 2) comptadors.mitjana++;
                else if (m < 8) comptadors.alta++;
                else comptadors.moltAlta++;
            }

            // Redibuixa eixos
            drawAxes();

            // âœ… Mostra els resultats fora del canvas
            const div = document.getElementById("resultats");
            div.innerHTML = `
                <strong>Resultats per grup de massa:</strong><br>
                ğŸŒ‘ Molt baixa (< 0.5 Mâ˜‰): ${comptadors.moltBaixa}<br>
                ğŸŒ˜ Baixa (0.5â€“1 Mâ˜‰): ${comptadors.baixa}<br>
                ğŸŒ— Mitjana (1â€“2 Mâ˜‰): ${comptadors.mitjana}<br>
                ğŸŒ• Alta (2â€“8 Mâ˜‰): ${comptadors.alta}<br>
                â˜€ï¸ Molt alta (> 8 Mâ˜‰): ${comptadors.moltAlta}
            `;
        }

        // Dibuix inicial dels eixos
        drawAxes();
    </script>
</body>
</html>
